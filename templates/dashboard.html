{% extends 'base.html' %} {% block content %}

<h2 class="fw-bold text-center mb-4" style="color: var(--cgu-red)">
  CGU Alumni Network Dashboard
</h2>

<div class="dashboard-container">
  <!-- ============================================================
       MAIN PANEL — Student + Mentor
  ============================================================ -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="card profile-card">
        <img
          src="{{ url_for('static', filename='profile_placeholder.png') }}"
          alt="Profile"
          class="profile-pic" />

        <h3>{{ dashboard.full_name }}</h3>
        <p><strong>Email:</strong> {{ dashboard.email }}</p>
        <p>
          <strong>Phone:</strong> {{ dashboard.phone_number or 'Not provided' }}
        </p>

        <p>
          <strong>Degree:</strong> {{ dashboard.degree_level }} — {{
          dashboard.degree_name }}
        </p>

        {% if dashboard.user_type == 'student' %}
        <p>
          <strong>Years in Program:</strong> {{ dashboard.current_year or 'N/A'
          }}
        </p>
        <p>
          <strong>Expected Graduation:</strong> {{
          dashboard.expected_graduation_year or 'N/A' }}
        </p>
        {% else %}
        <p>
          <strong>Current Position:</strong> {{ dashboard.current_position or
          'N/A' }}
        </p>
        <p><strong>Company:</strong> {{ dashboard.company_name or 'N/A' }}</p>
        {% endif %}

        <div class="profile-actions mt-3">
          <a href="{{ url_for('profile') }}" class="btn">View Profile</a>
        </div>
      </div>
    </div>
  </div>

  <!-- ============================================================
       ROW 2 — Academic Progress + Preferences
  ============================================================ -->
  <div class="row g-4 mb-4">
    <!-- Academic Progress -->
    <div class="col-lg-6">
      <div class="card stat-card">
        <div class="card-header">Academic Progress</div>
        <div class="card-body">
          <canvas id="progressChart"></canvas>
          <p style="margin-top: 10px">Classes Completed vs Remaining</p>
        </div>
      </div>
    </div>

    <!-- Preferences / Location -->
    <div class="col-lg-6">
      <div class="card stat-card">
        <div class="card-header">Preferences</div>
        <div class="card-body">
          <p>
            <strong>Organization:</strong> {{ dashboard.loc_org or 'Not set' }}
          </p>
          <p><strong>City:</strong> {{ dashboard.loc_city or 'Not set' }}</p>
          <p><strong>State:</strong> {{ dashboard.loc_state or 'Not set' }}</p>
          <p>
            <strong>Country:</strong> {{ dashboard.loc_country or 'Not set' }}
          </p>
          <p>
            <strong>Region:</strong> {{ dashboard.loc_region or 'Not set' }}
          </p>
        </div>
      </div>
    </div>
  </div>
  <!-- END Row 2 -->

  <!-- ============================================================
       ROW 3 — Career Pathways + Mentorship + Networking
  ============================================================ -->
  <div class="row g-4">
    <!-- Career Pathways -->
    <div class="col-lg-4">
      <div class="card stat-card">
        <div class="card-header">Career Pathways</div>
        <div class="card-body">
          <p>
            <strong>Industry:</strong> {{ dashboard.industry_name or 'Not set'
            }}
          </p>
          <p>
            <strong>Sub-Industry:</strong> {{ dashboard.sub_industry or 'Not
            set' }}
          </p>
          <p>
            <strong>Sector Code:</strong> {{ dashboard.sector_code or 'Not set'
            }}
          </p>
          <p>
            <strong>Description:</strong> {{ dashboard.industry_description or
            'Not available' }}
          </p>
        </div>
      </div>
    </div>

    <!-- Mentorship -->
    <div class="col-lg-4">
      <div class="card stat-card">
        <div class="card-header">Mentorship</div>
        <div class="card-body">
          {% if dashboard.user_type == 'student' %}
          <p>
            <strong>Seeking Mentor:</strong>
            {{ 'Yes' if dashboard.is_seeking_mentorship else 'No' }}
          </p>
          <p>
            <strong>Profile Visibility:</strong> {{ dashboard.profile_visibility
            }}
          </p>
          {% else %}
          <p>
            <strong>Open to Mentoring:</strong>
            {{ 'Yes' if dashboard.is_mentor else 'No' }}
          </p>
          <p>
            <strong>Profile Visibility:</strong> {{ dashboard.profile_visibility
            }}
          </p>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- Networking Opportunities 
    <div class="col-lg-4">
      <div class="card stat-card">
        <div class="card-header">Networking Opportunities</div>
        <div class="card-body">
          <ul class="scholar-list">
            <li><span class="dot"></span> Opportunities coming soon</li>
          </ul>
        </div>
      </div>
    </div>
  </div>-->
  
  
    <!-- Networking Opportunities -->
	<div class="col-lg-4">
	  <div class="card stat-card">
        <div class="card-header">Job Opportunities</div>
        <div class="card-body">

        <!-- Button -->
        <button id="btn-jobs" class="btn btn-primary mb-3">
			Find Job Opportunities
        </button>

        <!-- Where AI Results Will Show -->
        <div id="jobs-results">
        </div>

        </div>
      </div>
    </div>

  
  <!-- END Row 3 -->
</div>
<!-- END dashboard-container -->

<!-- ============================================================
     Chart.js
============================================================ -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const completedClasses = 2;
  const plannedClasses = 19;
  const ctx = document.getElementById("progressChart").getContext("2d");

  new Chart(ctx, {
    type: "doughnut",
    data: {
      labels: ["Completed", "Planned"],
      datasets: [
        {
          data: [completedClasses, plannedClasses],
          backgroundColor: ["#a50f15", "#f4b9b9"],
          borderWidth: 0,
        },
      ],
    },
    options: {
      cutout: "70%",
      plugins: {
        legend: {
          position: "bottom",
          labels: { boxWidth: 15 },
        },
      },
    },
  });
</script>


<script>
document.addEventListener("DOMContentLoaded", () => {
  console.log("✅ DOMContentLoaded fired");

  const btn = document.getElementById("btn-jobs");
  const resultsDiv = document.getElementById("jobs-results");

  console.log("btn:", btn);
  console.log("resultsDiv:", resultsDiv);

  if (!btn || !resultsDiv) {
    console.error("❌ Button or results div not found");
    return;
  }

  btn.addEventListener("click", async () => {
    console.log("✅ Button clicked");
    resultsDiv.innerHTML = "<p>Loading job opportunities...</p>";

    try {
      const res = await fetch("/api/job-opportunities", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          industry_id: 1  // TODO: replace with the real id from your dashboard
          // or { industry_name: "Telecommunications" }
        })
      });

      const text = await res.text();
      console.log("Status:", res.status);
      console.log("Raw body:", text);

      if (!res.ok) {
        resultsDiv.innerHTML = `<p>Server error (${res.status})</p>`;
        return;
      }

      const data = JSON.parse(text);

      if (data.error) {
        resultsDiv.innerHTML = `<p>Error: ${data.error}</p>`;
        return;
      }

      resultsDiv.innerHTML = "";
      data.jobs.forEach(job => {
        const div = document.createElement("div");
        div.className = "p-2 mb-2 border rounded";
        div.innerHTML = `
          <strong>${job.job_title}</strong><br>
          <p>${job.short_summary}</p>
          <p><strong>Search query:</strong> ${job.suggested_search_query}</p>
          <p><strong>Keywords:</strong> ${job.recommended_keywords}</p>
          <p><strong>Typical locations:</strong> ${job.typical_locations}</p>
        `;
        resultsDiv.appendChild(div);
      });

    } catch (err) {
      console.error("❌ Fetch/parse error:", err);
      resultsDiv.innerHTML = "<p>Failed to load job opportunities.</p>";
    }
  });
});
</script>


{% endblock %}





